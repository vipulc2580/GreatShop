  {% extends "base.html" %}
  {% load static %}
  {% block content %}
  <section class="product-section">
    <div class="container">
      <div class="row align-items-center gx-5 gy-5">
        <div class="col-lg-6">
          <div class="product-image-box">
            <img src="{{ product.image.url }}" alt="{{ product.product_name }}" class="img-fluid product-main-img">
          </div>
        </div>
        <div class="col-lg-6">
          <div class="product-info-box">
            <h2 class="product-title">{{ product.product_name }}</h2>
            <div class="rating-star">
              <span>
                <i class="{% if product.averageRating >= 1 %}fa-solid fa-star{% elif product.averageRating >= 0.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                <i class="{% if product.averageRating >= 2 %}fa-solid fa-star{% elif product.averageRating >= 1.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                <i class="{% if product.averageRating >= 3 %}fa-solid fa-star{% elif product.averageRating >= 2.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                <i class="{% if product.averageRating >= 4 %}fa-solid fa-star{% elif product.averageRating >= 3.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                <i class="{% if product.averageRating >= 5 %}fa-solid fa-star{% elif product.averageRating >= 4.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
              </span>
              <span>{{ product.reviewCount }} reviews</span>
            </div>
            <p class="product-price">â‚¹{{ product.price }}</p>
            <p class="product-description">{{ product.description }}</p>
        
            <form method="POST" action="{% url 'add_cart' product.id %}" id='product-form'>
              {% csrf_token %}
        
              <div class="custom-options my-4">
                <!-- Color Selection -->
                <div class="mb-3">
                  <label class="option-label">Color</label>
                  <div class="option-buttons">
                    <!-- Silver -->
                     {% for color in color_variation  %}
                      <input type="radio" class="btn-check" name="color" id="color-{{color}}" value="{{color|lower}}" autocomplete="off" required>
                      <label class="btn btn-outline-primary me-2" for="color-{{color}}">{{color|capfirst}}</label>
                      {% endfor %}
                      <small class="text-danger d-none" id="color-error">Please select a color.</small>
                  </div>
                </div>
        
                <!-- Size Selection -->
                <div>
                  <label class="option-label">Size</label>
                  <div class="option-buttons">
                    {% for size in size_variation %}
                    <input type="radio" class="btn-check" name="size" id="size-{{size}}" value="{{size|lower}}" autocomplete="off">
                    <label class="btn btn-outline-secondary me-2" for="size-{{size}}">{{size|capfirst}}</label>
                    {% endfor %}
                    <small class="text-danger d-none" id="size-error">Please select a size.</small>
                  </div>
                </div>
              </div>
        
              {% if product.stock <= 0 %}
                <h5 class="text-danger">Out of Stock</h5>
              {% else %}
                  <button type="submit" class="btn-buy-now">Add to Cart <i class="fas fa-shopping-cart ms-2"></i></button>
              {% endif %}
            </form>
          </div>
        </div>
        
      </div>

      <div class="row mt-5">
        <div class="col-lg-10 mx-auto">
          <form action="{% url 'submit_review' product.id %}" method='POST'>
            {% csrf_token %}
            <h5>Write Your Review</h5>
            <div>
              <!--Rating Stars-->
              <label for="">How do you rate this product?</label>
              <br>
              <div class="rate">
                <input type="radio" name='rating' id="rating10" value="5" required><label for="rating10" title="5"></label>
                <input type="radio" name='rating' id="rating9" value="4.5" required><label for="rating9" title="4.5" class="half"></label>
                <input type="radio" name='rating' id="rating8" value="4" required><label for="rating8" title="4"></label>
                <input type="radio" name='rating' id="rating7" value="3.5" required><label for="rating7" title="3.5" class="half"></label>
                <input type="radio" name='rating' id="rating6" value="3" required><label for="rating6" title="3"></label>
                <input type="radio" name='rating' id="rating5" value="2.5" required><label for="rating5" title="2.5" class="half"></label>
                <input type="radio" name='rating' id="rating4" value="2" required><label for="rating4" title="2"></label>
                <input type="radio" name='rating' id="rating3" value="1.5" required><label for="rating3" title="1.5" class="half"></label>
                <input type="radio" name='rating' id="rating2" value="1" required><label for="rating2" title="1"></label>
                <input type="radio" name='rating' id="rating1" value="0.5" required><label for="rating1" title="0.5" class="half"></label>
              </div>
              <br>
              <label for="">Review Title:</label>
              <input type="text" name="subject" class="form-control">
              <br>
              <label for="">Review:</label>
              <textarea name="review" row="4" id="" class="form-control"></textarea>
              <br>
              {% if user.is_authenticated %}
                {% if has_purchased %}
              <input type="submit" value="Submit Reveiw" class="btn btn-primary">
              {% else %}
              <p>You must purchase this product to post a review.</p>
              {% endif %}
              {% else %}
              <p>You must be logged in to post a review. <span><a href="{% url 'login'%}">Log In</a></span></p>
              {% endif %}
            </div>
          </form>
          <br>
          <h4 class="review-heading">Customer Reviews</h4>
          <div class="rating-star">
            <span>
              <i class="{% if product.averageRating >= 1 %}fa-solid fa-star{% elif product.averageRating >= 0.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
              <i class="{% if product.averageRating >= 2 %}fa-solid fa-star{% elif product.averageRating >= 1.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
              <i class="{% if product.averageRating >= 3 %}fa-solid fa-star{% elif product.averageRating >= 2.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
              <i class="{% if product.averageRating >= 4 %}fa-solid fa-star{% elif product.averageRating >= 3.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
              <i class="{% if product.averageRating >= 5 %}fa-solid fa-star{% elif product.averageRating >= 4.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
            </span>
            <span>{{ product.reviewCount }} reviews</span>
          </div>
          <div class="container my-4">
            {% for review in reviews %}
            <div class="card mb-3 shadow-sm">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start flex-wrap">
                  <div class="d-flex align-items-center mb-2">
                    <img src="{% static './images/avatars/avatar1.jpg' %}" class="rounded-circle me-2" width="50" height="50" alt="avatar">
                    <div>
                      <h6 class="mb-0">{{ review.user.full_name }}</h6>
                      <div class="rating-star text-warning">
                        <span>
                          <i class="{% if review.rating >= 1 %}fa-solid fa-star{% elif review.rating >= 0.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                          <i class="{% if review.rating >= 2 %}fa-solid fa-star{% elif review.rating >= 1.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                          <i class="{% if review.rating >= 3 %}fa-solid fa-star{% elif review.rating >= 2.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                          <i class="{% if review.rating >= 4 %}fa-solid fa-star{% elif review.rating >= 3.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                          <i class="{% if review.rating >= 5 %}fa-solid fa-star{% elif review.rating >= 4.5 %}fa-solid fa-star-half-stroke{% else %}fa-regular fa-star{% endif %}"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="ms-auto text-end text-muted small">
                    {{ review.updated_at|date:"d.m.Y" }}
                  </div>
                </div>
                <h6>{{ review.subject }}</h6>
                <p class="mt-2 mb-0">{{ review.review }}</p>
              </div>
            </div>
            {% endfor %}
          
            <!-- Example static review -->
            <div class="card mb-3 shadow-sm">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start flex-wrap">
                  <div class="d-flex align-items-center mb-2">
                    <img src="{% static './images/avatars/avatar1.jpg' %}" class="rounded-circle me-2" width="50" height="50" alt="avatar">
                    <div>
                      <h6 class="mb-0">Mike John</h6>
                      <div class="rating-star">
                        <i class="fa-solid fa-star"></i>  
                        <i class="fa-solid fa-star"></i>  
                        <i class="fa-solid fa-star-half-stroke"></i>  
                        <i class="fa-regular fa-star"></i> 
                        <i class="fa-regular fa-star"></i>  
                        
                      </div>
                    </div>
                  </div>
                  <div class="ms-auto text-end text-muted small">
                    24.04.2020
                  </div>
                </div>
                <h6>Sample Subject</h6>
                <p class="mt-2 mb-0">
                  Dummy comment Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById('product-form');
      const colorRadios = document.querySelectorAll("input[name='color']");
      const sizeRadios = document.querySelectorAll("input[name='size']");
      const colorError = document.getElementById("color-error");
      const sizeError = document.getElementById("size-error");
      function isSelected(radioGroup) {
        return [...radioGroup].some(r => r.checked);
      }
  
      function hideErrors() {
        if (isSelected(colorRadios)) colorError.classList.add("d-none");
        if (isSelected(sizeRadios)) sizeError.classList.add("d-none");
      }
  
      colorRadios.forEach(r => r.addEventListener("change", hideErrors));
      sizeRadios.forEach(r => r.addEventListener("change", hideErrors));
  
      form.addEventListener("submit", function (e) {
        let valid = true;
  
        if (!isSelected(colorRadios)) {
          colorError.classList.remove("d-none");
          valid = false;
        }
        if (!isSelected(sizeRadios)) {
          sizeError.classList.remove("d-none");
          valid = false;
        }
  
        if (!valid) {
          e.preventDefault();
        }
      });
    });
  </script>
  {% endblock %}
